var api=[];api['core/translator']=ajax_path+"core/translator.php";api['data/load']=ajax_path+"data/load.php";api['data/search']=ajax_path+"data/search.php";function initialize(){$('body').tooltip({selector:'[data-toggle="tooltip"], [data-tooltip=tooltip]'});$(".js_moment").each(function(){var _this=$(this);var time_utc=_this.attr('data-time');var locale=$('html').attr('lang')||'en-us';var offset=moment().utcOffset();var time=moment(time_utc).add({minutes:offset}).locale(locale);_this.text(time.fromNow()).attr('title',time.format("dddd, MMMM D, YYYY h:m a"));});$('.js_scroller').each(function(){var _this=$(this);if(_this.parent('.slimScrollDiv').length>0){return;}_this.slimScroll({height:function(){var init='280px';var height=_this.attr('data-slimScroll-height');if(height===undefined){return init;}return height;},distance:'2px'})});$('video.js_video-js').each(function(){videojs($(this)[0],{},function(){});});$('audio.js_mediaelementplayer').mediaelementplayer();}function destroy_slimScrol(element){if($(element).parent().hasClass('slimScrollDiv')){$(element).parent().replaceWith($(element));$(element).removeAttr('style');}}function render_template(selector,options){var template=$(selector).html();Mustache.parse(template);var rendered_template=Mustache.render(template,options);return rendered_template;}function modal(){if(arguments[0]=="#modal-login"){if($('#modal').data('bs.modal')){$('#modal').data('bs.modal').options={backdrop:'static',keyboard:false};}else{$('#modal').modal({backdrop:'static',keyboard:false});}}if(!$('#modal').is(":visible"))$('#modal').modal('show');$('.modal-content:last').html(render_template(arguments[0],arguments[1]));}function modal_update(selector){$(selector).html($('.modal-content:last').html());}function confirm(title,message,callback){modal('#modal-confirm',{'title':title,'message':message});$("#modal-confirm-ok").click(function(){if(callback)callback();});}function is_empty(value){if(value.match(/\S/)==null){return true;}else{return false;}}function photo_grid(){$('.pg_2o3_in').each(function(){if($(this).parents('.pg_3x').length>0){var width=height=$(this).parents('.pg_3x').width()*0.667;}if($(this).parents('.pg_4x').length>0){var width=height=$(this).parents('.pg_4x').width()*0.749;}$(this).width(width);$(this).height(height);});$('.pg_1o3_in').each(function(){if($(this).parents('.pg_3x').length>0){var width=$(this).parents('.pg_3x').width()*0.332;var height=($(this).parent('.pg_1o3').prev().height()-1)/2;}if($(this).parents('.pg_4x').length>0){var width=$(this).parents('.pg_4x').width()*0.25;var height=($(this).parent('.pg_1o3').prev().height()-2)/3;}$(this).width(width);$(this).height(height);});}function see_more(element){if(element.hasClass('done'))return;var _this=element;var loading=_this.find('.loader');var text=_this.find('span');var remove=_this.attr('data-remove')||false;var stream=_this.parent().find('ul:first');var data={};data['get']=_this.attr('data-get');if(_this.attr('data-filter')!==undefined){data['filter']=_this.attr('data-filter');}if(_this.attr('data-type')!==undefined){data['type']=_this.attr('data-type');}if(_this.attr('data-uid')!==undefined){data['uid']=_this.attr('data-uid');}if(_this.attr('data-id')!==undefined){data['id']=_this.attr('data-id');}data['offset']=_this.attr('data-offset')||1;_this.addClass('loading');text.hide();loading.removeClass('x-hidden');$.post(api['data/load'],data,function(response){_this.removeClass('loading');text.show();loading.addClass('x-hidden');if(response.callback){eval(response.callback);}else{if(response.data){data['offset']++;if(response.append){stream.append(response.data);}else{stream.prepend(response.data);}setTimeout(photo_grid(),200);}else{if(remove){_this.remove();}else{_this.addClass('done');text.text(__['There is no more data to show']);}}}_this.attr('data-offset',data['offset']);},'json').fail(function(){_this.removeClass('loading');text.show();loading.addClass('x-hidden');modal('#modal-message',{title:__['Error'],message:__['There is something that went wrong!']});});}$(function(){initialize();$(document).ajaxComplete(function(){initialize();});FastClick.attach(document.body);$('.js_autogrow').autogrow({'animate':false});$(window).bind("load",function(){photo_grid();});$(window).bind("resize",function(){setTimeout(photo_grid(),200);});$('body').on('click','[data-toggle="modal"]',function(e){e.preventDefault();var url=$(this).attr('data-url');if(url.indexOf('#')==0){modal(url);}else{$.getJSON(ajax_path+url,function(response){eval(response.callback);}).fail(function(){modal('#modal-message',{title:__['Error'],message:__['There is something that went wrong!']});});}});$('body').on('click','.js_dropdown-keepopen, .slimScrollBar',function(e){e.stopPropagation();});$('body').on('click','.btn-group a',function(e){e.preventDefault();var parent=$(this).parents('.btn-group');parent.find('input[type="hidden"]').val($(this).attr('data-value'));parent.find('.btn-group-text').text($(this).text());parent.find('.btn-group-icon').attr("class",$(this).find('i.fa').attr("class")).addClass('btn-group-icon');parent.attr('data-original-title',$(this).attr('data-title'));parent.attr('data-value',$(this).attr('data-value'));parent.tooltip();});$('.js_toggle-panel').click(function(event){event.preventDefault;var parent=$(this).parents('.panel-body');parent.hide();parent.siblings().fadeIn();return false;});$('body').on('submit','.js_ajax-forms',function(e){e.preventDefault();var _this=$(this);var url=_this.attr('data-url');var submit=_this.find('button[type="submit"]');var error=_this.find('.alert.alert-danger');var success=_this.find('.alert.alert-success');if(_this.find('.js_hidden-section').length>0&&!_this.find('.js_hidden-section').is(':visible')){_this.find('.js_hidden-section').slideDown();return false;}submit.data('text',submit.html());submit.prop('disabled',true);submit.html(__['Loading']);$.post(ajax_path+url,$(this).serialize(),function(response){submit.prop('disabled',false);submit.html(submit.data('text'));if(response.error){if(success.is(":visible"))success.hide();error.html(response.message).slideDown();}else if(response.success){if(error.is(":visible"))error.hide();success.html(response.message).slideDown();}else{eval(response.callback);}},"json").fail(function(){submit.prop('disabled',false);submit.html(submit.data('text'));if(success.is(":visible"))success.hide();error.html(__['There is something that went wrong!']).slideDown();});});$('body').on('click','.js_translator',function(){var language=$(this).attr('data-language');$.post(api['core/translator'],{'language':language},function(response){if(!response)return;if(response.callback){eval(response.callback);}},'json').fail(function(){modal('#modal-message',{title:__['Error'],message:__['There is something that went wrong!']});});});$('body').on('click','.js_see-more',function(){see_more($(this));});$('.js_see-more-infinite').bind('inview',function(event,visible){if(visible==true){see_more($(this));}});$('body').on('click','.js_see-more-text',function(){$(this).next('span').show();$(this).remove();});$('body').on('keyup','#search-input',function(){var query=$(this).val();if(!is_empty(query)){$('#search-results').show();var hashtags=query.match(/#(\w+)/ig);if(hashtags!==null&&hashtags.length>0){var query=hashtags[0].replace("#","");$('#search-results .dropdown-widget-header').hide();$('#search-results-all').hide();$('#search-results .dropdown-widget-body').html(render_template('#search-for',{'query':query,'hashtag':true}));}else{$.post(api['data/search'],{'query':query},function(response){if(response.callback){eval(response.callback);}else if(response.results){$('#search-results .dropdown-widget-header').show();$('#search-results-all').show();$('#search-results .dropdown-widget-body').html(response.results);$('#search-results-all').attr('href',site_path+'/search/'+query);}else{$('#search-results .dropdown-widget-header').hide();$('#search-results-all').hide();$('#search-results .dropdown-widget-body').html(render_template('#search-for',{'query':query}));}},'json');}}});$('body').on('keydown','#search-input',function(event){if(event.keyCode==13){event.preventDefault;var query=$(this).val();if(!is_empty(query)){var hashtags=query.match(/#(\w+)/ig);if(hashtags!==null&&hashtags.length>0){var query=hashtags[0].replace("#","");window.location=site_path+'/search/hashtag/'+query}else{window.location=site_path+'/search/'+query}}return false;}});$('body').on('click','#search-input',function(){if($(this).val()!=''){$('#search-results').show();}});$('body').on('click',function(e){if(!$(e.target).is("#search-input")){$('#search-results').hide();}});$('body').on('submit','.js_search-form',function(e){e.preventDefault;var query=this.query.value;if(!is_empty(query)){var hashtags=query.match(/#(\w+)/ig);if(hashtags!==null&&hashtags.length>0){var query=hashtags[0].replace("#","");window.location=site_path+'/search/hashtag/'+query}else{window.location=site_path+'/search/'+query}}return false;});});